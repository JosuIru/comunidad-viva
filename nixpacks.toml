[phases.setup]
nixPkgs = ["nodejs-18_x", "openssl", "bash"]

[phases.install]
cmds = [
  "echo '=== NIXPACKS INSTALL PHASE ==='",
  "pwd",
  "ls -la | head -20",
  "echo 'Installing backend dependencies...'",
  "npm install"
]

[phases.build]
cmds = [
  "echo '=== NIXPACKS BUILD PHASE ==='",
  "pwd",
  "echo 'Generating Prisma Client...'",
  "npx prisma generate",
  "echo 'Building TypeScript...'",
  "npm run build",
  "echo 'Verifying build output...'",
  "ls -la dist/ | head -20",
  "test -f dist/main.js && echo 'BUILD SUCCESS: dist/main.js exists' || echo 'BUILD FAILED: dist/main.js not found'"
]

[start]
cmd = "bash start.sh"
