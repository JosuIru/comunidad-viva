# Comunidad Viva

Red social de econom√≠a colaborativa local con sistema h√≠brido revolucionario de capas econ√≥micas.

**üöÄ [Quick Start Guide](QUICK_START.md)** - Empieza en 5 minutos

**üìö Documentaci√≥n:**
- [API Reference](API_REFERENCE.md) - Referencia completa de ~120 endpoints
- [Changelog](CHANGELOG.md) - Historial de implementaciones
- [Sistema H√≠brido](packages/backend/src/hybrid/README.md) - Gu√≠a del sistema de capas econ√≥micas
- [Gobernanza](CONSENSUS_GOVERNANCE_GUIDE.md) - Proof of Help y consenso descentralizado

## üåü Caracter√≠sticas Principales

### üîÑ Sistema H√≠brido de Capas Econ√≥micas

**Innovaci√≥n revolucionaria:** Primer sistema que permite la coexistencia pac√≠fica de 3 paradigmas econ√≥micos diferentes.

#### Capas Disponibles

- **üè¶ TRADITIONAL (Capitalismo)**
  - Precios en euros y cr√©ditos
  - Transacciones tradicionales
  - Sistema de reviews y reputaci√≥n
  - Ideal para comercio local

- **üîÑ TRANSITIONAL (Pay-it-Forward)**
  - Econom√≠a de regalo gradual
  - "Paga lo que recibiste, cuando puedas"
  - Sistema de cadena de favores
  - Transici√≥n suave hacia econom√≠a colaborativa

- **üéÅ GIFT_PURE (Econom√≠a de Regalo Pura)**
  - Post-dinero, sin precios ni intercambios
  - Compartir abundancia an√≥nimamente
  - Expresar necesidades sin verg√ºenza
  - Celebraciones comunitarias de abundancia
  - Cero tracking, cero deuda

- **ü¶é CHAMELEON (Experimental)**
  - Prueba diferentes capas temporalmente
  - Bridge events para experimentos comunitarios
  - Sin compromiso permanente
  - Perfecto para explorar

#### Funcionalidades del Sistema

- ‚úÖ **Migraci√≥n libre entre capas** - Cambia cuando quieras
- ‚úÖ **Estad√≠sticas en tiempo real** - Ve la distribuci√≥n de tu comunidad
- ‚úÖ **Bridge events** - Experimentos temporales (ej: "semana sin dinero")
- ‚úÖ **Umbral de migraci√≥n** - Si 70% est√° en GIFT, prop√≥n migraci√≥n colectiva
- ‚úÖ **Configuraci√≥n por comunidad** - Cada comunidad elige sus reglas
- ‚úÖ **M√©tricas detalladas** - Analytics de transiciones econ√≥micas

**Total:** 16 endpoints REST completamente funcionales

[üìñ Documentaci√≥n completa del Sistema H√≠brido](packages/backend/src/hybrid/README.md)

---

### üéÆ Gamificaci√≥n y Engagement Viral

**Sistema completo para maximizar engagement y retenci√≥n de usuarios.**

#### Onboarding Gamificado
- Tutorial interactivo de 5 pasos
- Recompensas por completar perfil (+50 cr√©ditos)
- Gu√≠a contextual personalizada

#### Flash Deals (Ofertas Rel√°mpago)
- Descuentos por tiempo limitado (2-4 horas)
- Scarcity marketing (cantidades limitadas)
- Notificaciones push en tiempo real
- Rotaci√≥n autom√°tica 3 veces al d√≠a

#### Stories (Historias 24h)
- Contenido ef√≠mero tipo Instagram
- Auto-destrucci√≥n despu√©s de 24 horas
- Contador de vistas
- Perfecto para compartir momentos

#### Swipe & Match
- Descubrimiento tipo Tinder para ofertas
- Like / Dislike / Super Like
- Matches cuando ambas partes est√°n interesadas
- Algoritmo de recomendaci√≥n personalizado

#### Challenges (Retos)
- Retos semanales rotativos
- Leaderboard con rankings
- Bonus especial para los primeros 10
- Tipos: ayudar vecinos, crear ofertas, asistir eventos

#### Sistema de Referidos
- C√≥digos personalizados √∫nicos
- Recompensas para ambas partes (20 + 10 cr√©ditos)
- Milestones con bonos progresivos
- Tracking de referidos activos

#### Sugerencias Personalizadas
- IA para recomendar ofertas relevantes
- Sugerencias de eventos cercanos
- Conexiones con usuarios afines
- Basado en historial y preferencias

#### Live Events
- Eventos en vivo con contadores
- Check-in presencial
- Premios para participantes
- Gamificaci√≥n de eventos f√≠sicos

#### Micro-actions (Acciones Diarias)
- Peque√±as tareas con recompensas inmediatas
- Se resetean cada d√≠a
- Tipos: ver 3 ofertas, dar 1 like, comentar post
- +2-5 cr√©ditos por acci√≥n

#### Niveles y Progresi√≥n
- 10 niveles de progresi√≥n (1-10)
- Sistema de XP por acciones
- Perks desbloqueables por nivel
- Badges especiales por hitos

#### Streaks (Rachas)
- Racha de d√≠as activos consecutivos
- Multiplicador de recompensas (hasta √ó2)
- Milestones: 7, 14, 30, 60, 90 d√≠as
- Badges por constancia

#### Happy Hour
- Per√≠odos con cr√©ditos dobles
- Activaci√≥n autom√°tica 2-3 veces/semana
- Duraci√≥n: 1-2 horas
- Notificaci√≥n al iniciar

**Total:** 32 endpoints (26 funcionales + 6 admin)

---

### üèõÔ∏è Gobernanza Descentralizada (Proof of Help)

**Sistema de consenso inspirado en Bitcoin, adaptado para econom√≠a colaborativa.**

#### Proof of Help (PoH)
- **Miner√≠a = Ayudar a otros** (no consumir energ√≠a)
- Cada hora de ayuda genera "hash de trabajo"
- La validaci√≥n requiere haber ayudado previamente
- Consenso basado en reputaci√≥n social verificable

#### Trust Chain (Blockchain Local)
- Cadena de confianza inmutable
- Cada ayuda = un bloque enlazado
- Hash criptogr√°fico + prueba de trabajo social
- 4 tipos de bloques: HELP, PROPOSAL, VALIDATION, DISPUTE

#### Sistema de Reputaci√≥n
- C√°lculo autom√°tico basado en contribuciones
- 3 niveles con privilegios progresivos:
  - **Activo** (10+ ayudas): Validar transacciones simples
  - **Contribuidor** (50+ ayudas): Validar propuestas
  - **Experto** (100+ ayudas): Resolver disputas

- Factores de reputaci√≥n:
  - Ayudas dadas (√ó5)
  - Ayudas recibidas (√ó2)
  - Badges ganados (√ó10)
  - Conexiones sociales (√ó1)
  - Antig√ºedad (√ó3 por mes)
  - Validaciones correctas (√ó3)

#### Propuestas Comunitarias (CIPs)
- **Community Improvement Proposals**
- Requiere reputaci√≥n 20+ para crear
- Fase de discusi√≥n: 3 d√≠as
- Fase de votaci√≥n: 4 d√≠as
- Votaci√≥n cuadr√°tica (evita que pocos dominen)
- 4 tipos: FEATURE, RULE_CHANGE, FUND_ALLOCATION, PARTNERSHIP

#### Votaci√≥n Cuadr√°tica
```
Votar 1 punto  ‚Üí Cuesta 1¬≤ = 1 cr√©dito
Votar 5 puntos ‚Üí Cuesta 5¬≤ = 25 cr√©ditos
Votar 10 puntos ‚Üí Cuesta 10¬≤ = 100 cr√©ditos
```
Ventaja: Promueve consenso amplio vs dictadura de mayor√≠as

#### Moderaci√≥n Descentralizada
- Mini-DAOs temporales por cada reporte
- Jurado aleatorio (5-7 personas):
  - 3 con alta reputaci√≥n
  - 2 usuarios aleatorios
- Consenso 66% requerido
- 3 decisiones: KEEP, REMOVE, WARN
- Jurados correctos ganan 1 cr√©dito

#### Validaci√≥n de Ayudas
- Cada transacci√≥n de banco de tiempo requiere consenso
- 3 validadores seleccionados por:
  - Proximidad geogr√°fica (40%)
  - Reputaci√≥n (40%)
  - Aleatoriedad (20%)
- Consenso 2/3 ‚Üí Transacci√≥n aprobada
- Validadores ganan 1 cr√©dito por validaci√≥n correcta

**Beneficios sobre sistemas centralizados:**
- ‚úÖ Sin punto √∫nico de fallo
- ‚úÖ Resistente a censura
- ‚úÖ Incentivos alineados con bien com√∫n
- ‚úÖ Transparencia total y auditabilidad
- ‚úÖ Gobernanza evolutiva

[üìñ Gu√≠a completa de Gobernanza](CONSENSUS_GOVERNANCE_GUIDE.md)

---

### üìã Funcionalidades Base

- ‚úÖ **Autenticaci√≥n JWT** - Registro, login, gesti√≥n de sesiones
- ‚úÖ **Gesti√≥n de Usuarios** - Perfiles, avatares, configuraci√≥n
- ‚úÖ **Comunidades** - Locales, tem√°ticas, profesionales
- ‚úÖ **Sistema de Ofertas** - Productos, servicios, banco de tiempo
- ‚úÖ **Eventos** - Crear, asistir, gestionar eventos comunitarios
- ‚úÖ **Banco de Tiempo** - Registrar ayudas, balance de horas
- ‚úÖ **Compras Grupales** - Organizar compras colectivas
- ‚úÖ **Mensajer√≠a** - Chat 1-a-1 entre usuarios
- ‚úÖ **Notificaciones** - Push notifications en tiempo real
- ‚úÖ **Sistema de Reviews** - Calificaciones y comentarios
- ‚úÖ **B√∫squeda** - Full-text search de ofertas, usuarios, comunidades
- ‚úÖ **Analytics** - Dashboard con m√©tricas clave
- ‚úÖ **Upload de Im√°genes** - Almacenamiento de fotos

---

### üìä Estad√≠sticas del Proyecto

- **Total Endpoints:** ~120
- **M√≥dulos Backend:** 20+
- **Paradigmas Econ√≥micos:** 3
- **Niveles de Gamificaci√≥n:** 10
- **Tipos de Bloques PoH:** 4
- **L√≠neas de Documentaci√≥n:** 2000+

## üöÄ Estructura del Proyecto

```
comunidad-viva/
‚îú‚îÄ‚îÄ packages/
‚îÇ   ‚îú‚îÄ‚îÄ backend/          # API NestJS con Prisma
‚îÇ   ‚îú‚îÄ‚îÄ web/              # Frontend Next.js
‚îÇ   ‚îî‚îÄ‚îÄ shared/           # Tipos compartidos
‚îú‚îÄ‚îÄ nginx/                # Configuraci√≥n nginx
‚îú‚îÄ‚îÄ backups/              # Backups de base de datos
‚îú‚îÄ‚îÄ scripts/              # Scripts de utilidad
‚îú‚îÄ‚îÄ docker-compose.yml    # Configuraci√≥n Docker desarrollo
‚îú‚îÄ‚îÄ docker-compose.prod.yml  # Configuraci√≥n Docker producci√≥n
‚îî‚îÄ‚îÄ Makefile             # Comandos de gesti√≥n
```

## üìã Requisitos

- Node.js 18+
- Docker & Docker Compose
- PostgreSQL 15
- Redis 7

## üõ†Ô∏è Instalaci√≥n

### 1. Clonar el repositorio

```bash
git clone <repository-url>
cd comunidad-viva
```

### 2. Configurar variables de entorno

```bash
cp .env.example .env
# Editar .env con tus valores
```

### 3. Instalar dependencias

```bash
make install
```

## üèÉ Desarrollo

### Levantar entorno de desarrollo

```bash
make dev
```

Esto levantar√°:
- Backend API: http://localhost:4000
- Frontend: http://localhost:3000
- PostgreSQL: localhost:5432
- Redis: localhost:6379

### Ejecutar migraciones

```bash
make migrate
```

### Poblar base de datos con datos de prueba

```bash
make seed
```

## üö¢ Producci√≥n

### Build de im√°genes Docker

```bash
make build
```

### Levantar en producci√≥n

```bash
make prod
```

### Configuraci√≥n SSL para nginx

Genera certificados SSL y col√≥calos en `nginx/ssl/`:

```bash
mkdir -p nginx/ssl
# Generar certificados auto-firmados (desarrollo)
openssl req -x509 -nodes -days 365 -newkey rsa:2048 \
  -keyout nginx/ssl/key.pem \
  -out nginx/ssl/cert.pem

# Para producci√≥n, usa Let's Encrypt o tu proveedor de certificados
```

## üìä Monitoreo

### Levantar stack de monitoreo

```bash
make monitor
```

Esto levantar√°:
- Prometheus: http://localhost:9090
- Grafana: http://localhost:3001 (admin/admin)

## üíæ Backups

### Crear backup manual

```bash
make backup
```

### Restaurar desde backup

```bash
make restore
# Ingresar nombre del archivo de backup cuando se solicite
```

Los backups se crean autom√°ticamente cada 24 horas y se mantienen por 7 d√≠as.

## üß™ Testing

```bash
make test
```

## üìù Comandos disponibles

```bash
make help          # Ver todos los comandos disponibles
make install       # Instalar dependencias
make dev           # Desarrollo
make prod          # Producci√≥n
make build         # Build de im√°genes
make test          # Ejecutar tests
make clean         # Limpiar contenedores y vol√∫menes
make backup        # Backup de BD
make restore       # Restaurar BD
make seed          # Datos de prueba
make migrate       # Migraciones
make monitor       # Stack de monitoreo
make logs          # Ver logs
make stop          # Detener servicios
make restart       # Reiniciar servicios
make status        # Estado de servicios
```

## üîê Seguridad

### Variables de entorno importantes

Aseg√∫rate de cambiar estos valores en producci√≥n:

- `DB_PASSWORD`: Contrase√±a segura para PostgreSQL
- `JWT_SECRET`: Secreto para JWT (m√≠nimo 32 caracteres)
- `NEXTAUTH_SECRET`: Secreto para NextAuth (m√≠nimo 32 caracteres)

### Headers de seguridad

Nginx est√° configurado con headers de seguridad:
- X-Frame-Options
- X-Content-Type-Options
- X-XSS-Protection
- Referrer-Policy
- Content-Security-Policy

### Rate limiting

API endpoints tienen rate limiting configurado:
- API general: 10 req/s
- Auth endpoints: 5 req/m

## üöÄ Deploy en producci√≥n

### GitHub Actions

El proyecto incluye un workflow de CI/CD que:
1. Ejecuta tests y linting
2. Escaneo de seguridad con Trivy
3. Build y push de im√°genes Docker
4. Deploy autom√°tico a producci√≥n

### Variables de entorno necesarias en GitHub Secrets:

- `PROD_HOST`: Host del servidor de producci√≥n
- `PROD_USER`: Usuario SSH
- `PROD_SSH_KEY`: Clave SSH privada

### Deploy manual

```bash
# En el servidor de producci√≥n
cd /opt/comunidad-viva
git pull
docker-compose -f docker-compose.yml -f docker-compose.prod.yml up -d --build
```

## üìö Documentaci√≥n API

### Documentaci√≥n Interactiva

Una vez levantado el backend, accede a:
- **Swagger UI:** http://localhost:4000/api/docs

### Referencias Completas

- **[üìñ API Reference](API_REFERENCE.md)** - Documentaci√≥n completa de todos los endpoints (~120 endpoints)
- **[üìñ Sistema H√≠brido](packages/backend/src/hybrid/README.md)** - Gu√≠a del sistema de capas econ√≥micas
- **[üìñ Gobernanza](CONSENSUS_GOVERNANCE_GUIDE.md)** - Proof of Help y consenso descentralizado
- **[üìñ Changelog](CHANGELOG.md)** - Historial de implementaciones y cambios

### Principales Grupos de Endpoints

#### Sistema H√≠brido (16 endpoints)
```
POST   /hybrid/migrate              - Migrar entre capas econ√≥micas
GET    /hybrid/layer                - Obtener capa actual
GET    /hybrid/stats                - Estad√≠sticas de distribuci√≥n
POST   /hybrid/abundance            - Compartir abundancia (GIFT_PURE)
GET    /hybrid/abundance            - Listar recursos compartidos
POST   /hybrid/needs                - Expresar necesidad
GET    /hybrid/needs                - Ver necesidades de la comunidad
POST   /hybrid/bridge-events        - Crear experimento temporal
GET    /hybrid/bridge-events        - Listar experimentos activos
POST   /hybrid/celebrations         - Registrar celebraci√≥n
GET    /hybrid/celebrations         - Ver celebraciones recientes
GET    /hybrid/migration-threshold  - Verificar umbral de migraci√≥n
GET    /hybrid/config               - Configuraci√≥n de comunidad
PUT    /hybrid/config               - Actualizar configuraci√≥n
GET    /hybrid/transitions          - Historial de migraciones
GET    /hybrid/layer-metrics        - M√©tricas detalladas
```

#### Gamificaci√≥n Viral (32 endpoints)
```
# Onboarding
POST   /viral-features/onboarding/start          - Iniciar onboarding
POST   /viral-features/onboarding/complete-step  - Completar paso
GET    /viral-features/onboarding/progress       - Ver progreso

# Flash Deals
GET    /viral-features/flash-deals/active        - Ver ofertas activas
POST   /viral-features/flash-deals/claim/:id     - Reclamar oferta

# Stories
POST   /viral-features/stories                   - Crear story
GET    /viral-features/stories                   - Ver stories activas
POST   /viral-features/stories/:id/view          - Marcar como vista

# Swipe & Match
GET    /viral-features/swipe/next                - Siguiente oferta
POST   /viral-features/swipe                     - Swipe (like/dislike)
GET    /viral-features/swipe/matches             - Ver matches

# Challenges
GET    /viral-features/challenges/weekly         - Reto semanal
GET    /viral-features/challenges/leaderboard    - Clasificaci√≥n

# Referidos
GET    /viral-features/referrals/code            - Mi c√≥digo
POST   /viral-features/referrals/use             - Usar c√≥digo
GET    /viral-features/referrals/stats           - Estad√≠sticas

# Otros
GET    /viral-features/suggestions               - Sugerencias personalizadas
GET    /viral-features/live-events/active        - Eventos en vivo
GET    /viral-features/micro-actions/daily       - Acciones diarias
GET    /viral-features/levels/progress           - Progreso de nivel
GET    /viral-features/streaks                   - Racha actual
GET    /viral-features/happy-hour/status         - Estado happy hour

# Admin (triggers manuales)
POST   /admin/create-flash-deals                 - Crear flash deals
POST   /admin/activate-happy-hour                - Activar happy hour
POST   /admin/create-weekly-challenge            - Crear reto semanal
POST   /admin/clean-expired-stories              - Limpiar stories
POST   /admin/reset-daily-actions                - Reiniciar acciones
POST   /admin/update-streaks                     - Actualizar rachas
```

#### Gobernanza y Consenso
```
# Trust Blocks
POST   /consensus/blocks                    - Crear bloque
POST   /consensus/blocks/:id/validate       - Validar bloque

# Propuestas (CIPs)
POST   /consensus/proposals                 - Crear propuesta
POST   /consensus/proposals/:id/vote        - Votar propuesta
GET    /consensus/proposals                 - Listar propuestas

# Moderaci√≥n
POST   /consensus/moderation                - Reportar contenido
POST   /consensus/moderation/:id/vote       - Votar moderaci√≥n

# Reputaci√≥n
GET    /consensus/reputation                - Mi reputaci√≥n
GET    /consensus/reputation/:userId        - Reputaci√≥n de usuario
```

#### Core Features
- **Autenticaci√≥n:** `/auth/*` (login, register, logout)
- **Usuarios:** `/users/*` (profile, settings)
- **Comunidades:** `/communities/*` (CRUD, join/leave)
- **Ofertas:** `/offers/*` (CRUD, interested)
- **Eventos:** `/events/*` (CRUD, attend)
- **Banco de Tiempo:** `/timebank/*` (transactions, balance)
- **Compras Grupales:** `/groupbuys/*` (CRUD, join)
- **Mensajes:** `/messages/*` (conversations, send)
- **Notificaciones:** `/notifications/*` (list, read)
- **B√∫squeda:** `/search/*` (offers, users, communities)
- **Reviews:** `/reviews/*` (create, list)

## ü§ù Contribuci√≥n

1. Fork el proyecto
2. Crea una rama para tu feature (`git checkout -b feature/AmazingFeature`)
3. Commit tus cambios (`git commit -m 'Add some AmazingFeature'`)
4. Push a la rama (`git push origin feature/AmazingFeature`)
5. Abre un Pull Request

## üìÑ Licencia

Este proyecto est√° bajo licencia MIT.

## üÜò Soporte

Para reportar bugs o solicitar features, abre un issue en el repositorio.
