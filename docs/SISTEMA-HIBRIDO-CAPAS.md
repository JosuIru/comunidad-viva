# üåà Sistema H√≠brido de Capas de Realidad Econ√≥mica

## La Revoluci√≥n Suave: Una App, Infinitas Conciencias

Este documento describe la implementaci√≥n del **Sistema H√≠brido de Capas**, la caracter√≠stica m√°s revolucionaria de Comunidad Viva: permite que la misma aplicaci√≥n funcione simult√°neamente en m√∫ltiples paradigmas econ√≥micos.

---

## üéØ Concepto Core

La misma app funciona en **3 capas paralelas**:

### **Capa 1: TRADICIONAL** üå±
- Sistema familiar con cr√©ditos y medici√≥n completa
- Para quienes vienen del capitalismo tradicional
- Todo se registra, cuenta y balancea
- **70% de usuarios empiezan aqu√≠**

### **Capa 2: TRANSICIONAL** üåø
- Menos medici√≥n, m√°s flujo
- Cr√©ditos opcionales, registros que se olvidan
- √ânfasis en abundancia colectiva
- **Puente entre mundos**

### **Capa 3: REGALO PURO** üå≥
- Sin medici√≥n alguna
- Solo flujo y celebraci√≥n an√≥nima
- Cero c√°lculo, total libertad
- **El destino final**

### **Modo CAMALE√ìN** ü¶é
- Se adapta a quien interact√∫as
- Puente universal entre capas
- Para facilitadores

---

## üóÑÔ∏è Arquitectura de Base de Datos

### Modelo `User` (a√±adido)

```prisma
model User {
  // ... campos existentes ...

  // Sistema H√≠brido
  economicLayer    EconomicLayer @default(TRADITIONAL)
  layerConfig      Json          @default("{}")
  layerMigrations  LayerMigration[]
  softCredits      Int?          // Para capa transicional
  lastLayerChange  DateTime?
}

enum EconomicLayer {
  TRADITIONAL   // Capa tradicional
  TRANSITIONAL  // Capa transicional
  GIFT_PURE     // Regalo puro
  CHAMELEON     // Modo adaptativo
}
```

### Nuevos Modelos

#### 1. **LayerMigration** - Historial de transiciones
```prisma
model LayerMigration {
  id               String
  userId           String
  fromLayer        EconomicLayer
  toLayer          EconomicLayer
  reason           String?
  creditsConverted Int?  // Cr√©ditos donados al migrar
  migratedAt       DateTime
}
```

#### 2. **BridgeEvent** - Eventos puente para experimentar
```prisma
model BridgeEvent {
  id          String
  communityId String?
  type        BridgeEventType
  title       String
  description String

  forceLayer  EconomicLayer?  // Durante evento todos en esta capa

  startsAt    DateTime
  endsAt      DateTime
  recurring   Boolean
  frequency   String?  // "FIRST_SUNDAY", "EQUINOX"
}

enum BridgeEventType {
  GIFT_DAY        // Todo gratis primer domingo
  DEBT_AMNESTY    // Perd√≥n de deudas en equinoccios
  ABUNDANCE_FEST  // Festival cuando hay exceso
  LAYER_EXPERIMENT // Probar otra capa temporalmente
}
```

#### 3. **AbundanceAnnouncement** - Para capas regalo/transicional
```prisma
model AbundanceAnnouncement {
  id              String
  communityId     String?
  providerId      String?  // NULL en regalo puro (an√≥nimo)

  what            String   // "Tomates maduros"
  quantity        String?  // "Muchos" o n√∫mero
  where           String   // "Punto com√∫n"
  lat/lng         Float?

  visibleToLayers String[] // Qu√© capas pueden verlo
  takenBy         String[] // Quienes recibieron

  availableUntil  DateTime?
  expiresAt       DateTime?
}
```

#### 4. **NeedExpression** - Necesidades an√≥nimas
```prisma
model NeedExpression {
  id              String
  communityId     String?
  requesterId     String?  // NULL para total anonimato

  what            String
  why             String?
  where           String?  // √Årea general
  urgency         String?  // URGENT/SOON/WHENEVER

  visibleToLayers String[]
  fulfilledBy     String[]
  fulfilledAt     DateTime?
}
```

#### 5. **AnonymousCelebration** - Celebraciones sin nombres
```prisma
model AnonymousCelebration {
  id                       String
  communityId              String?

  event                    String  // "Una necesidad encontr√≥ abundancia"
  description              String?
  emoji                    String?

  approximateParticipants  Int?  // NO identifica espec√≠ficamente

  createdAt                DateTime
}
```

#### 6. **CommunityLayerConfig** - Configuraci√≥n por comunidad
```prisma
model CommunityLayerConfig {
  id                String
  communityId       String

  defaultLayer      EconomicLayer @default(TRADITIONAL)
  allowMixedMode    Boolean       @default(true)

  // Distribuci√≥n actual
  traditionalCount  Int @default(0)
  transitionalCount Int @default(0)
  giftCount         Int @default(0)
  chameleonCount    Int @default(0)

  // Eventos autom√°ticos
  autoGiftDays      Boolean @default(true)
  autoDebtAmnesty   Boolean @default(true)

  giftThreshold     Int @default(60)  // % para proponer migraci√≥n
}
```

---

## üîÑ Flujos de Interacci√≥n

### Mismo Evento, Tres Realidades

**Mar√≠a comparte 20 tomates:**

#### Usuario TRADICIONAL ve:
```
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
üì¶ Mar√≠a ofrece: 20 tomates
üí∞ Precio: 5 cr√©ditos
[COMPRAR] [NEGOCIAR]
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
```

#### Usuario TRANSICIONAL ve:
```
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
üçÖ Abundancia de tomates en el barrio
üíö Sugerencia: Una tarde de ayuda
[RECIBIR CON GRATITUD]
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
```

#### Usuario REGALO ve:
```
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
üçÖ Tomates maduros disponibles
üìç Punto com√∫n
[TOMAR LO NECESARIO]
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
```

### Interoperabilidad entre Capas

#### TRADICIONAL ‚Üî TRADICIONAL
```typescript
// Transacci√≥n normal
await recordTransaction({
  from: user1.id,
  to: user2.id,
  amount: 10,
  type: 'SERVICE',
});
```

#### TRADICIONAL ‚Üî REGALO
```typescript
if (direction === 'TRADITIONAL_GIVES') {
  // Tradicional da, pierde cr√©ditos
  await deductCredits(traditionalUser, amount);
  await sendMessage(traditionalUser,
    "Has hecho un regalo puro. No esperes retorno.");

  // Regalo recibe sin deuda
  await celebrate("El universo provee ‚ú®");
} else {
  // Regalo da sin contar
  await celebrate("Fluye el regalo üéÅ");

  // Tradicional recibe "cr√©ditos del cosmos"
  await addCredits(traditionalUser, amount);
  await sendMessage(traditionalUser,
    "Regalo del flujo com√∫n");
}
```

#### TRANSICIONAL ‚Üî REGALO
```typescript
// Ambos ven solo flujo
await celebrateFlow("Energ√≠a compartida üåä");

// Transicional puede registrar suavemente
if (transitionalUser.preferences.softTracking) {
  await softRecord({
    action: "Compart√≠",
    forgetsIn: 30, // d√≠as
  });
}
```

---

## üì± Interfaz Adaptativa

La UI se transforma seg√∫n tu capa:

### TRADICIONAL
```
Bottom Nav: [üí∞ Balance] [üìä Historial] [üõí Mercado] [üë§ Perfil]
Theme: Azul corporativo
Main Metric: "150 cr√©ditos"
```

### TRANSICIONAL
```
Bottom Nav: [üåä Flujo] [üë• Comunidad] [üåø Abundancia] [‚ú® Presencia]
Theme: Verde natural
Main Metric: "Fluyendo"
```

### REGALO PURO
```
Bottom Nav: [üéÅ Abundancia] [üíù Necesidades] [üéâ Celebrar] [ü§ù Coordinar]
Theme: Arco√≠ris vibrante
Main Metric: ‚ù§Ô∏è (sin m√©trica num√©rica)
```

---

## üé™ Eventos Puente

### 1. Domingos de Regalo (GIFT_DAY)
```typescript
{
  type: 'GIFT_DAY',
  title: 'üéÅ Domingo de Regalo',
  frequency: 'FIRST_SUNDAY',
  forceLayer: 'GIFT_PURE',
  description: 'Primer domingo del mes, TODO es regalo para TODOS'
}
```

**Efecto:** Usuarios tradicionales experimentan el regalo sin compromiso

### 2. Amnist√≠a de Deudas (DEBT_AMNESTY)
```typescript
{
  type: 'DEBT_AMNESTY',
  title: 'üåä Amnist√≠a de Deudas',
  frequency: 'EQUINOX_SOLSTICE',
  effect: 'Todas las deudas se perdonan',
  message: 'Nuevo ciclo, sin cargas del pasado'
}
```

**Efecto:** Libera mental y emocionalmente

### 3. Festival de Abundancia (ABUNDANCE_FEST)
```typescript
{
  type: 'ABUNDANCE_FEST',
  trigger: 'CUANDO_HAY_EXCESO',
  effect: 'Ese recurso temporal gratis para TODOS',
  learning: 'Experimentar abundancia'
}
```

---

## üîÑ Sistema de Migraci√≥n

### Migraci√≥n: TRADICIONAL ‚Üí TRANSITIONAL

```typescript
async migrateToTransitional(userId) {
  const currentBalance = await getBalance(userId);

  // Convertir a cr√©ditos suaves (opcionales)
  await convertToSoftCredits(userId, currentBalance);

  // Ocultar historial detallado
  await hideIndividualHistory(userId);

  // Desactivar rankings
  await disableLeaderboards(userId);

  return {
    message: "Tus cr√©ditos ahora son opcionales. Puedes usarlos o ignorarlos.",
    preserved: ["Cr√©ditos (opcionales)", "Conexiones"],
    removed: ["Rankings", "Historial detallado"],
    new: ["Estado de flujo", "M√©tricas colectivas"]
  };
}
```

### Migraci√≥n: TRANSITIONAL ‚Üí GIFT_PURE

```typescript
async migrateToGift(userId) {
  const softCredits = await getSoftCredits(userId);

  if (softCredits > 0) {
    // Donar cr√©ditos al com√∫n
    await donateToCommons(softCredits);

    await celebrate({
      event: `${softCredits} cr√©ditos liberados al flujo com√∫n ‚ú®`
    });
  }

  // Anonimizar usuario en transacciones pasadas
  await anonymizeUser(userId);

  return {
    message: "Has entrado al regalo puro. Ya no hay cuentas que llevar.",
    released: ["Cr√©ditos al com√∫n", "Identidad transaccional"],
    gained: ["Libertad total", "Presencia en el regalo"]
  };
}
```

### Regreso siempre posible (sin penalizaci√≥n)

```typescript
async migrateBack(userId, fromLayer, toLayer) {
  // Sin juicios, cada uno su tiempo
  await createProfile(userId, toLayer);

  if (toLayer === 'TRADITIONAL') {
    // Regalo de bienvenida
    await grantCredits(userId, 50);
  }

  return {
    message: "Perfil restaurado. Empiezas con balance base.",
    note: "Tu tiempo en otra capa no se perdi√≥, fue experiencia valiosa."
  };
}
```

---

## üìà Evoluci√≥n Natural de una Comunidad

### Mes 1
```
70% TRADICIONAL
25% TRANSICIONAL
5% REGALO
```

### Mes 6
```
40% TRADICIONAL
40% TRANSICIONAL
20% REGALO

Observaci√≥n: Migraci√≥n natural hacia menos medici√≥n
Interacciones cross-layer: 40%
```

### A√±o 1
```
20% TRADICIONAL (mayores, cautelosos)
30% TRANSICIONAL (transicionando)
50% REGALO

Decisi√≥n: Votaci√≥n para hacer regalo modo por defecto

Efectos:
- Gastos monetarios: -60%
- Tiempo liberado: +15h/semana
- √çndice felicidad: +40%
- Conflictos: -70%
```

### A√±o 2: Punto de No Retorno
```
5% TRADICIONAL (nuevos/visitantes)
15% TRANSICIONAL (puente)
80% REGALO

Realidad: El regalo es la norma
Nueva generaci√≥n: Ni√±os no entienden "comprar"
```

---

## üí° Incentivos Suaves (No Forzados)

### Mostrar sin presionar

```typescript
const stats = {
  tu_capa: {
    time_calculating: "2h/semana",
    stress_level: "Medio",
    genuine_connections: 12
  },

  next_layer: {
    time_calculating: "30min/semana",
    stress_level: "Bajo",
    genuine_connections: 25
  }
};

showStats(stats);
showButton("PROBAR 1 SEMANA", experimental: true);
showButton("SEGUIR AQU√ç", noJudgment: true);
```

### Estad√≠sticas inspiradoras

- 70% de usuarios en regalo reportan m√°s felicidad
- Usuarios en transici√≥n ahorran 2h/semana en c√°lculos
- Comunidades en regalo tienen 50% menos conflictos

---

## üõ†Ô∏è Implementaci√≥n T√©cnica

### Endpoints API

```
POST   /api/layer/migrate          - Migrar a otra capa
GET    /api/layer/current          - Ver capa actual
GET    /api/layer/stats            - Estad√≠sticas por capa
POST   /api/layer/experiment       - Probar temporalmente

POST   /api/abundance/announce     - Anunciar abundancia
GET    /api/abundance/feed         - Feed de abundancias
POST   /api/needs/express          - Expresar necesidad
GET    /api/needs/feed             - Feed de necesidades

POST   /api/celebration/create     - Crear celebraci√≥n
GET    /api/celebration/community  - Celebraciones comunidad

GET    /api/bridge-events          - Eventos puente pr√≥ximos
POST   /api/bridge-events/join     - Unirse a evento
```

### Servicio Principal

```typescript
class HybridLayerService {
  async migrateUser(userId, toLayer, reason?)
  async getUserLayer(userId)
  async crossLayerInteraction(user1, user2, interaction)
  async renderInterface(userId)
  async announceAbundance(data)
  async expressNeed(data)
  async createCelebration(data)
  async scheduleBridgeEvent(event)
}
```

---

## üåä Caracter√≠sticas Especiales Transici√≥n

### 1. Olvido Programado
```typescript
// Deudas se borran tras 30 d√≠as
await scheduleForgetfulness({
  type: 'DEBT',
  after: 30 // d√≠as
});

message: "No debes nada, el c√≠rculo contin√∫a"
```

### 2. Cr√©ditos que se Evaporan
```typescript
// Si acumulas mucho, se convierten en regalo com√∫n
if (credits > 100) {
  const decay = credits * 0.01; // 1% diario
  await convertToCommons(decay);

  message: "√ösalos o se vuelven de todos"
}
```

### 3. Modo Abundancia Autom√°tico
```typescript
// Cuando hay exceso de algo
if (detectExcess(resource)) {
  await activateAbundanceMode(resource);
  // Temporalmente gratis para TODOS
}
```

---

## üéì Onboarding: Elegir tu Capa

Al registrarse:

```
üå± MODO TRADICIONAL
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
‚úì Banco de tiempo con horas
‚úì Sistema de cr√©ditos
‚úì Historial completo
‚úì Badges y niveles

"Como las apps que conoces"
Recomendado para: Principiantes

‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

üåø MODO TRANSICI√ìN
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
‚úì Cr√©ditos opcionales
‚úì Se olvida tras 30 d√≠as
‚úì √ânfasis en abundancia
‚úì Sin competencia

"Menos n√∫meros, m√°s flujo"
Recomendado para: Exploradores

‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

üå≥ MODO REGALO PURO
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
‚úì Sin cuentas personales
‚úì Sin registros
‚úì Solo abundancia y necesidad
‚úì Pura celebraci√≥n

"Cero c√°lculo, total libertad"
Recomendado para: Revolucionarios

‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

ü¶é MODO CAMALE√ìN
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
‚úì Te adaptas a quien interact√∫as
‚úì Puente entre todos los modos

"El traductor universal"
Recomendado para: Facilitadores
```

---

## üéØ Por Qu√© Esto S√ç Funciona

### Para los Cautelosos
- Empiezan en terreno conocido
- Ven a otros prosperando en regalo
- Migran cuando est√°n listos

### Para los Exploradores
- Experimentan sin compromiso total
- Pueden ser puente para otros
- Ajustan su nivel seg√∫n contexto

### Para los Revolucionarios
- Viven ya en el nuevo paradigma
- Son faro para los dem√°s
- Pero pueden interactuar con todos

### Para la Comunidad
- No se fragmenta
- Todos pueden interactuar
- Evoluciona org√°nicamente
- Respeta todos los ritmos

---

## üöÄ Resultado Final

Una sola app que es simult√°neamente:

1. **Wallapop** (para tradicionales)
2. **Sistema de transici√≥n** (para exploradores)
3. **Econom√≠a del regalo** (para revolucionarios)
4. **Puente entre mundos** (para todos)

### La Belleza

No obligas a nadie a dar el salto.

Pero una vez prueban el regalo en los "Domingos Libres"...
Una vez sienten la abundancia en los "Festivales"...
Una vez experimentan que S√ç funciona sin contar...

**La migraci√≥n es inevitable.**

Como cuando pruebas streaming y no vuelves a alquilar DVDs.

No porque te obliguen.

**Porque es obviamente mejor.** ‚ú®

---

## üåä Conclusi√≥n: El Puente Perfecto

**Ventajas del Sistema H√≠brido:**

1. ‚úÖ NO FUERZA a nadie - cada uno a su ritmo
2. ‚úÖ PERMITE experimentar sin compromiso
3. ‚úÖ MANTIENE puentes entre mundos
4. ‚úÖ EVOLUCIONA org√°nicamente
5. ‚úÖ RESPETA la diversidad de consciencias

La misma app, infinitas posibilidades.

Como un r√≠o que puede fluir como:
- üö∞ **Tuber√≠a** (medido, controlado)
- üèûÔ∏è **Arroyo** (suave, natural)
- üåä **Oc√©ano** (sin l√≠mites ni medidas)

**Y todos beben la misma agua.**

---

*La misma app derrumba el capitalismo... suavemente.* üåà
